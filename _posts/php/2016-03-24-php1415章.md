---
layout: post
title:  "php14、15章"
date:   2016-03-24
categories: php
---


# 第十四章 PHP与AJAX

```
AJAX的核心是XMLHttpRequest。提供与服务器异步通信功能，从而让用户在请求时候不受到阻塞。
客户端使用javascript引擎向服务器端发送请求，服务器端根据用户端发送的请求返回指定内容。
```

### 优点与缺点

```
优点：
提供系统性能，优化用户界面，增强用户浏览体验
允许在不更新整个页面情况下维护数据，更为迅捷回应用户动作，避免发送网络上没改变的信息
取回必需的数据，大大减少数据交换
不需要浏览器插件，用户需要允许javascript在浏览器上执行
允许将服务器操作移动至客户端，减轻了服务器负担

缺点：
在不刷新情况下更新页面数据，这可能破坏浏览器（后退）按钮正常行为
在客户端执行，需要考虑AJAX兼容性
对串流媒体支持没flash、java applet好
AJAX代码存放在HTML页面中，项目代码泄露
动态更新页面使得用户难于将某个特定状态保存到收藏夹
无刷新重载，给用户带来困扰
用javascript做ajax引擎 ，需要考虑javascript兼容性和debug问题
手持设备不是很好的支持AJAX
```

### 创建XMLHttpRequest对象

```
**在IE中创建**
xmlhttp_request = new ActiveXObject("Msxml2.XMLHTTP.3.0");			//IE3.0/4.0/5.0支持
xmlhttp_request = new ActiveXObject("Msxml2.XMLHTTP");				//IE6.0
xmlhttp_request = new ActiveXObject("Microsoft.XMLHTTP");			//IE7.0以上

**在非IE中创建**
xmlhttp_request = new XMLHttpRequest();
如果服务器响应没有XML mine-type header,某些版本Mozilla浏览器可能无法正常工作，为了解决这个问题，如果服务器响应header不是text/xml,调用如下方法修改header:
xmlhttp_request = new XMLHttpRequest();
xmlhttp_request.overrideMimeType('text/xml');
```

```
**实际应用中AJAX编写在静态的HTML页面中的script标签以内，也可以编写在独立的javascript文件中，需要使用AJAX页面加载该javascript文件即可**

**在HTML中创建兼容不同浏览器的XMLHttpRequest对象**

<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtm11/DTD/xhtm11-transitional.dtd">                                               
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  
<title>Insert title here</title>
<script type="text/javascript">
var xmlhttp_request = false;    //定义xmlhttp_request变量
try{
  if( windows.ActiveXObject ){      //判断浏览器是否支持ActiveX对象
  	for( var i = 5; i; i-- ){      //根据浏览器版本使用不同方法创建对象
  		try{
  			if(i == 2){
  				xmlhttp_request = new ActiveXObject( "Mixcrosoft.XMLHTTP" );    //新建ActiveX对象，
  			}else{
  				xmlhttp_request = new ActiveXObject( "Msxml2.XMLHTTP." + i + ".0" );
  				xmlhttp_request.setRequestHeader("Content-Type","text/xml");
  				xmlhttp_request.setRequestHeader("Charset","utf-8");
  			}
  			break;
  		}catch(e){
  		xmlhttp_request = false;
  		}
  	}
  }else if( window.XMLHttpRequest ){      //判断浏览器是否支持XMLHttpRequest对象
  	xmlhttp_request = new XMLHttpRequest();
  	if (xmlhttp_request.overrideMimeType){
  		xmlhttp_request.overrideMimeType('text/xml');
  	}
  }
}catch(e){
	xmlhttp_request = false;
}
</script>
</head>
<body>
</body>
</html>

定义一个xmlhttp_request变量，判断当前用户浏览器是否支持ActiveX对象，并根据浏览器版本支持使用不同的方法创建对象。若用户浏览器不支持ActiveX对象，则判断浏览器是否支持XMLHttpRequest对象，在使用XMLHttpRequest组件来创建对象。
IE浏览器都支持ActiveX对象，都是采用Microsoft XMLHTTP组件来创建XMLHttpRequest对象。而Mozilla,Netscape,Safari等非IE系列浏览器几乎都支持XMLHttpRequest组件，直接使用该组件来创建XMLHttpRequest对象。
```

### 向服务器发送请求

```
XMLHttpRequest组件的一个特点就是可以不用刷新整个页面，直接与服务器进行交互，XMLHttpRequest组件向服务器发送请求方法如下：
xmlhttp_request.open(send_method, url, flag);
xmlhttp_request.send(null);
send_method为HTTP请求方式，可以用POST、GET或者服务器所支持的调用方法。按照HTTP规范，该参数需要大写，否则可能某些浏览器（firefox）无法处理该请求。
参数URl为XMLHttpRequest对象向服务器发出的请求的URl。为了防止跨站点脚本攻击，XMLHttpRequest对象所请求的URL必须使用于改页面相同的HTTP协议、web主机地址和端口。
参数flag为是否为异步模式，设置为true，可以继续执行页面javascript脚本而不用等待响应；设为false，则需要等待请求页面响应后，才能执行页面javascript脚本。
null调用XMLHttpRequest对象的send()方法，一般已经在所请求的URl中添加了要发送给服务器的数据，所以，此处不需要发送任何数据。  
```

```
**在HTML页面如何向服务器提交请求**
<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtm11/DTD/xhtm11-transitional.dtd">                                               
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  
<title>Insert title here</title>
<script type="text/javascript">
var xmlhttp_request = false;    //定义xmlhttp_request变量
try{
  if( windows.ActiveXObject ){      //判断浏览器是否支持ActiveX对象
    for( var i = 5; i; i-- ){      //根据浏览器版本使用不同方法创建对象
      try{
        if(i == 2){
          xmlhttp_request = new ActiveXObject( "Mixcrosoft.XMLHTTP" );    //新建ActiveX对象，
        }else{
          xmlhttp_request = new ActiveXObject( "Msxml2.XMLHTTP." + i + ".0" );
          xmlhttp_request.setRequestHeader("Content-Type","text/xml");
          xmlhttp_request.setRequestHeader("Charset","utf-8");
        }
        break;
      }catch(e){
      xmlhttp_request = false;
            }
    }
  }else if( window.XMLHttpRequest ){      //判断浏览器是否支持XMLHttpRequest对象
    xmlhttp_request = new XMLHttpRequest();
    if (xmlhttp_request.overrideMimeType){
      xmlhttp_request.overrideMimeType('text/xml');
    }
  }
}catch(e){
  xmlhttp_request = false;
}

function chkuserid(txt){
  var userid = txt.value;
  if(userid.length > 0){
    var url="/chk.php?userid=" + userid;
    xmlhttp_request.open("GET", url, true);
    xmlhttp_request.send(null);
  }
  
}
</script>
</head>
<body>

<form action="">
  <table>
    <thead>注册</thead>
    <tr>

</body>
</html>
```