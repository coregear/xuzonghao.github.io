---
layout: post
title:  "Puppet"
date:   2016-04-09
categories: Puppet
---


# 第一章 认识puppet

## puppet组织架构

```
|-- auth.conf 					#ACL权限控制文件
|-- fileserver.conf 			#文件服务配置文件
|-- manifests 					#节点存储目录（puppet会首先加载site.pp）
|	-- site.pp 					#定义puppet变量和默认配置
|-- modules						#模块配置目录
|	-- nginx					#以nginx为例
|		|-- manifests			
|		|	-- init.pp 			#模块主配置文件，定义类class相关信息。读取模块后先读取它
|		-- templates
|			--nginx.conf.erb 	#模板配置文件（erb为主）
|-- namespaceauth.conf 			#命名空间配置文件（配置权限）
|-- puppet.conf 				#puppet主配置文件
|-- tagmail.conf 				#邮件报告配置文件
```

### puppet是如何工作

```
定义-》模拟-》执行-》报告
```

### 安全与验证

```
SSL加密协议传输，没有内网也没有关系，SSL安全加密协议已经为我们解决了数据传输的安全问题
```

### puppet 认证

```
由于puppet采用的是SSL加密协议，因此申请证书是必须的
puppet master在启动后会向自己签发证书和key。
客户端2分钟请求一次master证书
```

### 主配置文件puppet.conf

```
用于设置参数、认证文件、文件系统配置文件、插件配置
puppet2.6以前版本命名方式以[puppetmaster]、[puppetagent]为主。
puppet2.6以后版本命名方式以[main]、[master]、[agent]为主。
生成puppet配置文件puppet.conf
puppetd --genconfig > /etc/puppet/puppet.conf
puppetmaster--genconfig > /etc/puppet/puppet.conf
puppet doc --reference configureation   #查看配置参考手册
puppet agent --configprint confdir     #查看配置文件在那个目录
```

### 不同版本配置查看

```
https://docs.puppet.com/references/
```
￼

### 主机配置文件site.pp

```
puppet apply --genmanifest > /etc/puppet/manifests/site.pp
```
￼

# 第二章  puppet安装与配置

## puppet支持的平台

```
LINUX
redhat enterprise Linux 4及更高版本
centos v4及其更高版本
scientif linux 4及其更高版本
oracle linux 4及其更高版本
debian v5 及其更高版本
Ubuntu v8.04LTS及其更高版本
fedora 15 及更高版本
suse linux enterprise server 11 及其更高版本
gentoo linux 
mandriva corporate server 4  
archlinux

BSD
freeBSD 4.7及其以上
openBSD 4.1及其更高版本

other unix
mac os x 10.5及其以上版本
oracle solaris 10及其更高版本
aix 5.3及其更高版本
HP-UX

windows
windows 2003 2008 7
```

## puppet对ruby支持

```
安装puppet之前需要安装ruby，puppet对ruby 1.8.7完美支持
```

|ruby version|puppet2.6|puppet 2.7|puppet 3.0|
|--|--|--|--|
|1.8.5*|支持|支持|不支持|
|1.8.7|支持|支持|支持|
|1.9.3|不支持|不支持|支持|
|1.9.0/1/2|不支持|不支持|不支持|
|1.8.1/6|不支持|不支持|不支持|


## puppet安装

```
```
